.panel-items.js-masonry {
    margin-left: -3%; //take away left margin added again by .panel
    margin-bottom: 100px; //buffer
    .panel {
        width: 30.3%;
        float:left;
        margin-left:3%;
        margin-bottom: 35px;
        @media (max-width: $screen-sm-min) {
            width: 50 - 3%;
        }
        @media (max-width: $screen-xs-min) {
            width: 97%;
        }
        &.double {
            width: 30.3% * 2 + 3%; //double width panel
        }
        &.panel-half {
            width: 50 - 3%;
            @media (max-width: $screen-sm-min) {
            width: 97%;
            }
        }
    }
}

.panel > .block > .list-group {
    margin-bottom: 0;
}

.panel > .block .list-group .list-group-item {
    border-width: 1px 0;
    border-radius: 0;
}

.panel-heading + .block > .list-group .list-group-item:first-child {
    border-top-width: 0;
}

.panel > .block .list-group:last-child .list-group-item:last-child{
    border-bottom: 0;
    border-bottom-right-radius: 3px;
    border-bottom-left-radius: 3px;
}

.panel-items {
    form {
        margin:0;
    }
    table {
        font-size: 0.9em;
    }
    small {
        margin-top:5px;
        line-height: 1.5em;
        font-size: 0.8em;
        color: $gray;
        display: block;
    }

    dl {
        dt {
            font-weight:normal;
            clear: both;
            margin-right:10px;
        }
        dd, dt {
            display:inline-block;
            float:left;
        }

        dd {
            color: $gray;
            line-height: 1.5em;
        font-size: 0.9em;
        }
    }
    .nav-pills {
        margin: 0;
    }
}

.panel-half {
    width: 48%;
    float: left;
    margin-left: 4%;
    &.first {
        margin-left:0;
    }
    @media (max-width: $screen-sm-min) {
        width: 100%;
        margin-left:0;
    }
}

a.panel-footer {
    text-align:center;
    color: #555;
    display: block;
    &:hover {
        color: #222;
        background: $gray-lighter;
        text-decoration: none;
        .fa {
            color: #777;
        }
        .fa.pull-right { //only apply link colorto right aligned icons
            color: $link-color;
        }
    }
    .fa.pull-right {
        margin-top: 3px;
    }
}

//Display objects in panels differently
.panel-body {
    ul {
        padding-left: 20px;
        margin: 0 0 20px;
        font-size: 0.9em;
    }
    .sidebar & .form-group {
        padding: 0;
    }
    .form-group.login{
        padding: 0;
        .form-group {
            padding: 0;
        }
    }
    > .panel-footer, 
    form .panel-footer {
        clear:both;
        margin: 15px -15px -16px; //alter padding for panel footers inside panel-body (needed for some forms) c.f. login form
    }
}

.collapsible legend h4,
.collapsible legend h3,
.panel-heading {
    position: relative;
    display: block;

    p {
        margin:0;
    }
    &.has-link {
        padding: 0;
    }
    a:not(.secondary-link) {
        display: block;
        color: inherit;
        padding: 10px 15px;
        
        &.collapsed {
            background-color: #f9f9f9;
            color: #333;
            padding: 10px 15px;
        }
        &:hover, &:focus {
            background-color: darken(#f5f5f5, 1%);
            text-decoration: none;
        }
        .pieform > .collapsible-group:first-child &,
        .first & {
            @include border-top-radius(3px);
        }
    }
    .help a { //fix css on contextual help icons
        padding: 0;
        &:hover {
            background:none;
        }
    }
}

/*
 * Input boxes positioned on the right over the panel header
 * or icon link positioned on the left over the panel header
 */
.panel-control {
    display: block;
    font-size: $font-size-base - 2;
    margin: 0;
    min-width: 0;
    padding: 12px 0 12px 15px;
    position: absolute;
    width: auto;
    z-index: 5;
    &.panel-header-action {
        right:0;
        top:0;
    }
   
    input {
        margin-top:0;
    }
    .control {
        display: inline-block;
        .control-wrapper {
            display: inline-block;
        }
    }
    .content-expanded {
        font-size: $font-size-small;
        color: $link-color;
    }
}
a.panel-control {
    &:hover, &:hover span {
        color: $link-color;
    }
}


.panel-collapse:not(.panel-secondary) {
    border: 0;

     // Remove border from heading - add to link tag. 
     // In this case we have a nested a tag that takes up the whole of the heading space
     // rather than applying the panel-header to the link
    .panel-heading {
        border: 0;
        a {
            @include text-shadow(1px 0 0 #fff);
        }
    }

    &.panel-primary{
        .panel-heading a {
            font-weight: bold;
        }
    }

    .panel-body,
    .panel-footer,
    .panel-heading a {
        border: 1px solid $panel-default-border;
    }
    .panel-heading a,
    .panel-body:not(.no-footer) {
        border-bottom-width:0;
    }

    &.last .panel-heading a.collapsed {
        border-bottom-width: 1px;
    }
    // Style variations
    @each $status, $bgcolor in $panel-background {
         &.panel-#{$status} {
            .panel-heading a {
                background-color: darken($bgcolor, 3%);
                &.collapsed {
                    background-color: $bgcolor;
                }
                &:hover,
                &:focus {
                   background-color: darken($bgcolor, 3%);
                }
            }
            .panel-footer,
            .panel-body,
            .panel-heading a {
                border: 1px solid darken($bgcolor, 15%);
            }
            .panel-heading a,
            .panel-body:not(.no-footer) {
                border-bottom-width:0;
            }
        }
    }
}


.panel-footer {
    &.has-form {
        @include clearfix;
        .control {
            display: inline-block;
        }
    }
    &.has-link {
        a {
            display: block;
        }
    }
    &.has-attachment {
        position: relative;
        z-index: 999;
    }
    .expand-add-button {
        .show-form {
            display: none;
        }
        .hide-form {
            display: inline-block;
        }
        &.collapsed {
            .show-form {
                display: inline-block;
            }
            .hide-form {
                display: none;
            }
        }
    }
    a:not(.btn) {
        color: #333;
    }
}

.panel-secondary {
    @include box-shadow(none);
    > .panel-heading, .panel-heading-nested {
        border-top: 3px solid $mahara-green-bright;
        background-color: $gray-lighter;
        border-bottom: 1px solid $panel-default-border;
    }
    &.panel-warning {
         > .panel-heading, .panel-heading-nested {
            border-top: 3px solid $mahara-green-bright;
            background-color: $panel-warning-heading-bg;
            border-bottom: 1px solid $panel-warning-border;
        }
    }
    .list-group .list-group-item { 
        border-left: 0;
        border-right: 0;
        &:first-child {
            border-top:0;
        }
    }
}

.panel-form {
    background-color: $panel-default-heading-bg;
    border-bottom: 1px solid $panel-default-border;
    padding: 15px;
    margin-bottom:20px;
}

.fieldset-body .panel-footer {
    margin: 20px -15px -10px;
}

.wallpost:first-child {
    margin-top:20px;
}

.columns3,
.columns4,
.columns5 {
    .wallpost .panel-heading{
        font-size: 12px;
        padding-right:40px;
    }
}

