/*jslint browser: true, nomen: true,  white: true */

jQuery(function($) {
"use strict";

    $('.pieform.jstabs').prepend('<ul class="nav nav-tabs"></ul>');

    var id,
        listitem,
        heading,
        tabcontent = $('.pieform.jstabs .pieform-fieldset').parent(),
        tabnav = $('.pieform.jstabs').find('.nav-tabs');

    // Remove class collasped that has been generated by pieform
    $('.pieform.jstabs .pieform-fieldset').removeClass('collapsed');
    tabcontent.removeClass('collapsed');

    // Add div and bootstrap class on tabcontent to show and hide
    tabcontent.addClass('tab-pane').wrapAll('<div class="tab-content">');
    tabcontent.first().addClass('active');

// Set up tab navigation
    for(var i = 0; i < tabcontent.length; i = i + 1){
        // get id and title from div (tabcontent)
        id = $(tabcontent[i]).attr('id');
        heading = $(tabcontent[i]).find('legend h4').first().text();

        listitem = '<li role="presentation"><a href="#'+id+'" data-toggle="tab">'+heading+'</a></li>';

        tabnav.append(listitem);
    }

    tabnav.find('li:first-child').addClass('active');




    // Remove extra padding when there are no site message
    if ($('.site-messages').length === 0) {
        $('.header').addClass('no-site-messages');
        $('.main-nav').addClass('no-site-messages');
    }



    
    // Add markup to switch type input
    $('.switch').each(function(index){
        
        var inputId = $(this).children('input').attr('id');

        $(this).append(
            '<label class="switch-label" for="'+ inputId +'"><span class="switch-inner"></span><span class="switch-switch"></span></label>'
        );
    });




    // Add bootstrap class to the add file content for filebrowser
    // modal screen
    $('#js-filebrowser').wrapInner('<div class="modal-dialog modal-lg"><div class="modal-content modal-filebrowser"></div></div>');
    $('#js-filebrowser').modal('hide');

    // Expand the last item of message thread 
    var lastMsgItemIndex = $('.message-item').length - 1;
    $('.js-message-content').each(function(index) {
        if (index === lastMsgItemIndex) {
            $(this).collapse();
        } else {
            $(this).addClass('collapse');
        }
    });

});
